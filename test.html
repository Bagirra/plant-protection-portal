<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Protection Portal</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.9/css/weather-icons.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules (v9+ modular syntax)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD2-uD34cHObkqQ8RE-Q6Dyb2vadfb2WtU",
            authDomain: "plant-49d4d.firebaseapp.com",
            projectId: "plant-49d4d",
            storageBucket: "plant-49d4d.appspot.com",
            messagingSenderId: "531376250260",
            appId: "1:531376250260:web:5990e5414890299a6c0381",
            measurementId: "G-45R61MG9V5"
        };

        // Initialize Firebase and Firestore
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        console.log("Firebase initialized:", app);

        // Function to add subscriber to Firestore
        async function addSubscriber(email, method, phone = null) {
            try {
                const docRef = await addDoc(collection(db, "subscribers"), {
                    email: email,
                    method: method,
                    phone: phone
                });
                console.log("Document written with ID: ", docRef.id);
            } catch (e) {
                console.error("Error adding document: ", e);
                throw e;
            }
        }

        // Subscription form logic
        document.addEventListener('DOMContentLoaded', function () {
            // Open the subscription popup
            document.getElementById('subscribeButton').addEventListener('click', function () {
                document.getElementById('subscribePopup').style.display = 'block';
            });

            // Hide phone input if method is Google
            document.getElementById('method').addEventListener('change', function () {
                if (this.value === 'phone') {
                    document.getElementById('phoneInput').classList.remove('hidden');
                } else {
                    document.getElementById('phoneInput').classList.add('hidden');
                }
            });

            // Handle form submission
            document.getElementById('subscribeForm').addEventListener('submit', function (e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const method = document.getElementById('method').value;
                const phone = method === 'phone' ? document.getElementById('phone').value : null;

                console.log("Submitting form with:", { email, method, phone });

                // Add subscriber to Firestore
                addSubscriber(email, method, phone).then(() => {
                    alert('Вы успешно подписались на уведомления!');
                    document.getElementById('subscribePopup').style.display = 'none';
                }).catch(error => {
                    console.error('Ошибка при подписке:', error);
                    alert('Произошла ошибка при подписке.');
                });
            });
        });
    </script>

    <style>
        /* Пример CSS для скрытия элемента */
        .hidden {
            display: none;
        }
        /* Пример CSS для всплывающего окна */
        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .popup-content {
            background: white;
            padding: 20px;
            border-radius: 5px;
            width: 300px;
        }
    </style>
</head>

<body>
    <div class="content-wrapper">
        <!-- Your existing HTML content... -->

        <!-- Subscription form -->
        <a href="#" class="button" id="subscribeButton">Подписаться на уведомления</a>

        <!-- Всплывающее окно для подписки -->
        <div id="subscribePopup" class="popup" style="display:none;">
            <div class="popup-content subscription-form">
                <h2>Подписка на уведомления</h2>
                <form id="subscribeForm">
                    <label for="email">Электронная почта:</label>
                    <input type="email" id="email" required>
                    
                    <label for="method">Выберите метод подписки:</label>
                    <select id="method" required>
                        <option value="phone">По номеру телефона</option>
                        <option value="google">Через Google аккаунт</option>
                    </select>
                    
                    <div id="phoneInput" class="hidden">
                        <label for="phone">Введите номер телефона:</label>
                        <input type="tel" id="phone">
                    </div>
                    
                    <button type="submit" class="button">Подписаться</button>
                </form>
            </div>
        </div>

        <!-- Your existing footer -->
    </div>
</body>
</html>
